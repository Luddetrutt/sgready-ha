type: vertical-stack
cards:
  - type: horizontal-stack
    cards:
      - show_name: true
        show_icon: true
        type: button
        name: Normal
        icon: mdi:home
        tap_action:
          action: call-service
          service: select.select_option
          service_data:
            entity_id: select.sg_ready_ai_override
            option: force_normal
        hold_action:
          action: call-service
          service: select.select_option
          service_data:
            entity_id: select.sg_ready_ai_override
            option: auto
        card_mod:
          style: |
            ha-card {
              {% set mode = states('sensor.sg_ready_lage') %}
              {% set ai = states('select.sg_ready_ai_override') %}
              {% if ai == 'auto' and mode == 'normal' %}
              border: 3px solid var(--primary-color) !important;
              box-shadow: 0 0 10px var(--primary-color) !important;
              {% elif ai == 'force_normal' %}
              border: 3px solid var(--warning-color) !important;
              box-shadow: 0 0 10px var(--warning-color) !important;
              {% endif %}
            }
      - show_name: true
        show_icon: true
        type: button
        name: Boost
        icon: mdi:lightning-bolt
        tap_action:
          action: call-service
          service: select.select_option
          service_data:
            entity_id: select.sg_ready_ai_override
            option: force_boost
        card_mod:
          style: |
            ha-card {
              {% set mode = states('sensor.sg_ready_lage') %}
              {% set ai = states('select.sg_ready_ai_override') %}
              {% if ai == 'auto' and mode == 'boost' %}
              border: 3px solid var(--success-color) !important;
              box-shadow: 0 0 10px var(--success-color) !important;
              {% elif ai == 'force_boost' %}
              border: 3px solid var(--warning-color) !important;
              box-shadow: 0 0 10px var(--warning-color) !important;
              {% endif %}
            }
      - show_name: true
        show_icon: true
        type: button
        name: Block
        icon: mdi:block-helper
        tap_action:
          action: call-service
          service: select.select_option
          service_data:
            entity_id: select.sg_ready_ai_override
            option: force_block
        card_mod:
          style: |
            ha-card {
              {% set mode = states('sensor.sg_ready_lage') %}
              {% set ai = states('select.sg_ready_ai_override') %}
              {% if ai == 'auto' and mode == 'block' %}
              border: 3px solid var(--error-color) !important;
              box-shadow: 0 0 10px var(--error-color) !important;
              {% elif ai == 'force_block' %}
              border: 3px solid var(--warning-color) !important;
              box-shadow: 0 0 10px var(--warning-color) !important;
              {% endif %}
            }
      - show_name: true
        show_icon: true
        type: button
        name: Auto
        icon: mdi:robot-outline
        tap_action:
          action: call-service
          service: select.select_option
          service_data:
            entity_id: select.sg_ready_ai_override
            option: auto
        card_mod:
          style: |
            ha-card {
              {% if states('select.sg_ready_ai_override') == 'auto' %}
              border: 3px solid var(--primary-color) !important;
              box-shadow: 0 0 10px var(--primary-color) !important;
              {% endif %}
            }

  - type: horizontal-stack
    cards:
      - type: entity
        entity: sensor.sg_ready_lage
        name: Läge
        icon: mdi:heat-pump
        state_color: true
      - type: entity
        entity: sensor.sg_ready_aktuellt_pris
        name: Pris nu
        icon: mdi:currency-usd
      - type: entity
        entity: sensor.sg_ready_prisrankning
        name: Rankning
        icon: mdi:sort-numeric-ascending

  - type: markdown
    content: |
      {% set d = state_attr('sensor.sg_ready_lage', 'reason') %}
      {% set ai = states('select.sg_ready_ai_override') %}
      Orsak: {{ d or '-' }}
      {% if ai != 'auto' %}
      Manuellt lage aktivt - hall inne Normal for att atergå till auto
      {% endif %}

  - type: entities
    title: Prisalgoritm
    icon: mdi:chart-bell-curve
    entities:
      - entity: number.sg_ready_boost_procent
        name: "Boost \u2014 billigaste timmar"
        icon: mdi:arrow-up-bold-circle
      - entity: number.sg_ready_block_procent
        name: "Block \u2014 dyraste timmar"
        icon: mdi:arrow-down-bold-circle
      - entity: number.sg_ready_mintemperatur
        name: Mintemperatur (block-skydd)
        icon: mdi:thermometer-low

  - type: entities
    title: "Produktionsöverstyrning (solceller)"
    icon: mdi:solar-power
    show_header_toggle: false
    entities:
      - entity: number.sg_ready_produktion_normal_troskel
        name: "Normal-tröskel (W)"
        icon: mdi:solar-power
      - entity: number.sg_ready_produktion_boost_troskel
        name: "Boost-tröskel (W)"
        icon: mdi:solar-power-variant
      - entity: number.sg_ready_produktion_atergangs_troskel
        name: "Återgångs-tröskel (W)"
        icon: mdi:transmission-tower-import
      - entity: number.sg_ready_produktion_hysteres
        name: Hysteres (W)
        icon: mdi:sine-wave
      - entity: number.sg_ready_produktion_aktiveringstid
        name: Aktiveringstid (s)
        icon: mdi:timer-sand
      - entity: number.sg_ready_produktion_avstangningstid
        name: Avstängningstid (s)
        icon: mdi:timer-off
